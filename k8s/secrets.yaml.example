# Secrets Template

This file shows the structure for `secrets.yaml`. Copy this to `secrets.yaml` and fill in your values.

## Creating Your Secrets File

```bash
cp k8s/secrets.yaml.example k8s/secrets.yaml
nano k8s/secrets.yaml
```

## Example Structure

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: lootchat-secrets
  namespace: lootchat
type: Opaque
stringData:
  # Database Configuration
  POSTGRES_USER: lootchat
  POSTGRES_PASSWORD: CHANGE_THIS_PASSWORD
  POSTGRES_DB: lootchat
  DATABASE_USERNAME: lootchat
  DATABASE_PASSWORD: CHANGE_THIS_PASSWORD
  
  # JWT Secret (generate with: openssl rand -base64 32)
  JWT_SECRET: CHANGE_THIS_SECRET
  
  # Session Password (generate with: openssl rand -base64 32)
  NUXT_SESSION_PASSWORD: CHANGE_THIS_SECRET
  
  # Admin User
  ADMIN_PASSWORD: CHANGE_THIS_PASSWORD
  
  # Email SMTP (Optional)
  MAIL_USERNAME: your-email@gmail.com
  MAIL_PASSWORD: your-app-password
  
  # Domain Configuration
  DOMAIN: yourdomain.com
  CORS_ALLOWED_ORIGINS: https://yourdomain.com
  
  # App URLs
  APP_PUBLIC_BASE_URL: https://yourdomain.com
  NUXT_PUBLIC_API_URL: https://yourdomain.com
  
  # Optional: Tenor API Key for GIFs
  NUXT_PUBLIC_TENOR_API_KEY: ""
  
  # MinIO Configuration
  MINIO_ROOT_USER: minioadmin
  MINIO_ROOT_PASSWORD: CHANGE_THIS_PASSWORD
  
  # Redis Password
  REDIS_PASSWORD: CHANGE_THIS_PASSWORD
  
  # LiveKit Configuration
  LIVEKIT_API_KEY: your-api-key
  LIVEKIT_API_SECRET: your-api-secret
  LIVEKIT_KEYS: your-api-key:your-api-secret
```

## Generating Secure Secrets

```bash
# Generate JWT secret (32 characters)
openssl rand -base64 32

# Generate session password (32 characters)
openssl rand -base64 32

# Generate strong password (24 characters)
openssl rand -base64 24
```

## Applying Secrets

After creating and editing your secrets file:

```bash
kubectl apply -f k8s/secrets.yaml
```

## Security Best Practices

1. **Never commit secrets to git**
2. **Use strong passwords** (16+ characters, mixed case, numbers, symbols)
3. **Change default passwords** immediately after deployment
4. **Rotate secrets regularly** (every 90 days)
5. **Use unique secrets per environment** (dev, staging, prod)
6. **Consider using a secret manager** (Vault, AWS Secrets Manager, etc.)

## Alternative: Using kubectl

You can also create secrets directly:

```bash
kubectl create secret generic lootchat-secrets \
  --namespace=lootchat \
  --from-literal=POSTGRES_USER=lootchat \
  --from-literal=POSTGRES_PASSWORD=your-password \
  --from-literal=JWT_SECRET=your-jwt-secret \
  # ... add all other secrets
```

## Using SOPS for GitOps

For GitOps workflows, use [SOPS](https://github.com/mozilla/sops) to encrypt secrets:

### 1. Install SOPS

```bash
# macOS
brew install sops

# Linux
wget https://github.com/getsops/sops/releases/download/v3.8.1/sops-v3.8.1.linux.amd64
sudo mv sops-v3.8.1.linux.amd64 /usr/local/bin/sops
sudo chmod +x /usr/local/bin/sops
```

### 2. Generate GPG Key

```bash
# Generate a new GPG key (choose RSA 4096)
gpg --full-generate-key

# List your keys and get the fingerprint
gpg --list-secret-keys --keyid-format LONG

# Export your public key fingerprint (it looks like: 257FE55DA640258047E315BDA1A93F69AFEE8BD8)
gpg --list-keys
```

### 3. Create .sops.yaml Configuration

Create `k8s/.sops.yaml`:

```yaml
creation_rules:
  - path_regex: secrets\.yaml$
    encrypted_regex: ^(data|stringData)$
    pgp: YOUR_GPG_FINGERPRINT_HERE
```

Replace `YOUR_GPG_FINGERPRINT_HERE` with your actual GPG fingerprint from step 2.

### 4. Encrypt Your Secrets

```bash
# Create your secrets file first
cp k8s/secrets.yaml.example k8s/secrets.yaml
# Edit k8s/secrets.yaml with your actual values
nano k8s/secrets.yaml

# Encrypt the secrets file in place
sops -e -i k8s/secrets.yaml

# The file is now encrypted! You can safely commit it to git
git add k8s/secrets.yaml k8s/.sops.yaml
git commit -m "Add encrypted secrets"
```

### 5. Decrypt Secrets (When Needed)

```bash
# View decrypted content
sops -d k8s/secrets.yaml

# Edit encrypted file (decrypts, opens editor, re-encrypts on save)
sops k8s/secrets.yaml

# Decrypt to a temporary file for kubectl
sops -d k8s/secrets.yaml | kubectl apply -f -
```

### 6. Share GPG Key with Team (Optional)

If working in a team:

```bash
# Export private key (keep this VERY secure!)
gpg --export-secret-keys YOUR_GPG_FINGERPRINT > private.key

# Export public key (can be shared)
gpg --export YOUR_GPG_FINGERPRINT > public.key

# Team members import the key
gpg --import private.key
```

### SOPS Configuration Example

Your `.sops.yaml` should look like:

```yaml
creation_rules:
  - path_regex: secrets\.yaml$
    encrypted_regex: ^(data|stringData)$
    pgp: 257FE55DA640258047E315BDA1A93F69AFEE8BD8
```

### Encrypted File Structure

After encryption, your `secrets.yaml` will look like:

```yaml
apiVersion: v1
kind: Secret
metadata:
    name: lootchat-secrets
    namespace: lootchat
type: Opaque
stringData:
    POSTGRES_USER: ENC[AES256_GCM,data:abc123...,iv:xyz...]
    POSTGRES_PASSWORD: ENC[AES256_GCM,data:def456...,iv:uvw...]
    # ... all values encrypted
sops:
    pgp:
        - fingerprint: YOUR_GPG_FINGERPRINT
    version: 3.8.1
```

## Security Best Practices

For multiple environments:

```
k8s/
  secrets/
    dev-secrets.yaml
    staging-secrets.yaml
    prod-secrets.yaml
```

Apply the appropriate file:

```bash
kubectl apply -f k8s/secrets/prod-secrets.yaml
```
